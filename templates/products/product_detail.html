{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Crookeries{% endblock %}

{% block content %}
<div class="container mx-auto px-4 lg:px-8 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
        <div>
            {% if product.images.all %}
            <div class="rounded-lg overflow-hidden shadow-lg border border-beige mb-4">
                <img id="mainImage" 
                     src="{{ product.images.all.0.image.url }}" 
                     alt="{{ product.name }}" 
                     class="w-full h-auto">
            </div>
            {% if product.images.all|length > 1 %}
            <div class="grid grid-cols-4 gap-4">
                {% for image in product.images.all %}
                <button onclick="document.getElementById('mainImage').src='{{ image.image.url }}'" 
                        class="rounded-lg overflow-hidden border-2 border-beige hover:border-brown-light transition">
                    <img src="{{ image.image.url }}" alt="{{ product.name }}" class="w-full h-auto">
                </button>
                {% endfor %}
            </div>
            {% endif %}
            {% else %}
            <div class="aspect-square bg-beige rounded-lg flex items-center justify-center">
                <span class="text-gray-medium text-6xl">üçΩÔ∏è</span>
            </div>
            {% endif %}
        </div>

        <div>
            <nav class="text-sm text-gray-medium mb-4">
                <a href="{% url 'core:home' %}" class="hover:text-brown-dark">Home</a> / 
                <a href="{% url 'products:shop' %}" class="hover:text-brown-dark">Shop</a> / 
                <span class="text-brown-dark">{{ product.name }}</span>
            </nav>

            <h1 class="text-4xl font-serif font-bold text-brown-dark mb-4">{{ product.name }}</h1>
            
            <div class="flex items-center gap-4 mb-6">
                <div class="flex items-center">
                    {% for i in "12345" %}
                        {% if forloop.counter <= product.average_rating %}
                        <span class="text-brown-light text-xl">‚òÖ</span>
                        {% else %}
                        <span class="text-beige text-xl">‚òÖ</span>
                        {% endif %}
                    {% endfor %}
                    <span class="ml-2 text-gray-medium">({{ product.review_count }} reviews)</span>
                </div>
            </div>

            <div class="mb-6">
                <div class="flex items-baseline gap-4">
                    <span class="text-4xl font-bold text-brown-dark">${{ product.price }}</span>
                    {% if product.compare_price %}
                    <span class="text-2xl text-gray-medium line-through">${{ product.compare_price }}</span>
                    <span class="text-lg text-green-600 font-semibold">Save {{ product.discount_percentage }}%</span>
                    {% endif %}
                </div>
            </div>

            <p class="text-lg text-gray-medium mb-6 leading-relaxed">{{ product.short_description }}</p>

            <div class="mb-6">
                {% if product.stock > 0 %}
                <span class="inline-block px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                    ‚úì In Stock ({{ product.stock }} available)
                </span>
                {% else %}
                <span class="inline-block px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-semibold">
                    Out of Stock
                </span>
                {% endif %}
            </div>

            <div class="flex gap-4 mb-8">
                <button class="flex-1 btn-primary px-8 py-4 rounded-full text-lg font-semibold">
                    Add to Cart
                </button>
                <button class="px-6 py-4 border-2 border-brown-dark text-brown-dark rounded-full hover:bg-brown-dark hover:text-white transition">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>

            <div class="border-t border-beige pt-6">
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-gray-medium">Category:</span>
                        <span class="text-brown-dark font-semibold ml-2">{{ product.category.name }}</span>
                    </div>
                    {% if product.brand %}
                    <div>
                        <span class="text-gray-medium">Brand:</span>
                        <span class="text-brown-dark font-semibold ml-2">{{ product.brand.name }}</span>
                    </div>
                    {% endif %}
                    <div>
                        <span class="text-gray-medium">SKU:</span>
                        <span class="text-brown-dark font-semibold ml-2">{{ product.sku }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mb-16">
        <div class="border-b border-beige mb-8">
            <h2 class="text-3xl font-serif font-bold text-brown-dark pb-4 inline-block border-b-4 border-brown-dark">Description</h2>
        </div>
        <div class="prose max-w-none text-gray-medium">
            {{ product.description|linebreaks }}
        </div>
    </div>

    {% if related_products %}
    <div>
        <h2 class="text-3xl font-serif font-bold text-brown-dark mb-8">You May Also Like</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for related in related_products %}
            <a href="{% url 'products:product_detail' related.slug %}" class="group">
                <div class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 border border-beige">
                    {% if related.images.all.0 %}
                    <div class="aspect-square overflow-hidden bg-beige">
                        <img src="{{ related.images.all.0.image.url }}" 
                             alt="{{ related.name }}" 
                             class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                    </div>
                    {% else %}
                    <div class="aspect-square bg-beige flex items-center justify-center">
                        <span class="text-gray-medium text-4xl">üçΩÔ∏è</span>
                    </div>
                    {% endif %}
                    <div class="p-4">
                        <h3 class="font-semibold text-brown-dark mb-2 group-hover:text-brown-light transition">{{ related.name }}</h3>
                        <span class="text-xl font-bold text-brown-dark">${{ related.price }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
